# --------------------------------------------------------------------------------------------------
# ---------------------------------- MELD :: External Resampler ------------------------------------
# --------------------------------------------------------------------------------------------------
import torch.nn as nn
import torch


# --------------------------------------------------------------------------------------------------
# ---------------------------------------- CLASS :: Resampler --------------------------------------
# --------------------------------------------------------------------------------------------------
class Resampler(nn.Module):

    # ----------------------------------------------------------------------------------------------
    # --------------------------------- CONSTRUCTOR :: Constructor ---------------------------------
    # ----------------------------------------------------------------------------------------------
    def __init__(self) -> None:
        super(Resampler, self).__init__()

        self.mu = nn.Linear(4096, 4096)
        self.lv = nn.Linear(4096, 4096)


    # ----------------------------------------------------------------------------------------------
    # ----------------------------- METHOD :: Reparameterization Trick -----------------------------
    # ----------------------------------------------------------------------------------------------
    def reparameterize(self, mu, log_var):
        std = torch.exp(0.5 * log_var)
        eps = torch.randn_like(std)
        return mu + eps * std


    # ----------------------------------------------------------------------------------------------
    # ------------------------------- METHOD :: Forward Propagation --------------------------------
    # ----------------------------------------------------------------------------------------------
    def forward(self, x: torch.Tensor) -> torch.Tensor:

        mu = self.mu(x)
        lv = self.lv(x)

        return self.reparameterize(mu, log_var), mu, lv