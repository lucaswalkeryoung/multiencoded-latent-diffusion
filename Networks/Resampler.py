# --------------------------------------------------------------------------------------------------
# ---------------------------------- MELD :: External Resampler ------------------------------------
# --------------------------------------------------------------------------------------------------
import torch.nn as nn
import torch


# --------------------------------------------------------------------------------------------------
# ---------------------------------------- CLASS :: Resampler --------------------------------------
# --------------------------------------------------------------------------------------------------
class Resampler(nn.Module):

    # ----------------------------------------------------------------------------------------------
    # --------------------------------- CONSTRUCTOR :: Constructor ---------------------------------
    # ----------------------------------------------------------------------------------------------
    def __init__(self, input_size, latent_size) -> None:
        super(Resampler, self).__init__()

        self.mu_layer = nn.Linear(input_size, latent_size)
        self.log_var_layer = nn.Linear(input_size, latent_size)


    # ----------------------------------------------------------------------------------------------
    # ----------------------------- METHOD :: Reparameterization Trick -----------------------------
    # ----------------------------------------------------------------------------------------------
    def reparameterize(self, mu, log_var):
        std = torch.exp(0.5 * log_var)
        eps = torch.randn_like(std)
        return mu + eps * std


    # ----------------------------------------------------------------------------------------------
    # ------------------------------- METHOD :: Forward Propagation --------------------------------
    # ----------------------------------------------------------------------------------------------
    def forward(self, x: torch.Tensor) -> torch.Tensor:

        mu = self.mu_layer(x)
        log_var = self.log_var_layer(x)

        latent_z = self.reparameterize(mu, log_var)
        return latent_z, mu, log_var